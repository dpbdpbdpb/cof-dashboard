<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="generator" content="Observable Framework v1.13.3">
<title>COF Portfolio Dashboard</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Source+Serif+4:ital,opsz,wght@0,8..60,200..900;1,8..60,200..900&amp;display=swap" crossorigin>
<link rel="preload" as="style" href="./_import/style.6ae57e22.css">
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css2?family=Source+Serif+4:ital,opsz,wght@0,8..60,200..900;1,8..60,200..900&amp;display=swap" crossorigin>
<link rel="stylesheet" type="text/css" href="./_import/style.6ae57e22.css">
<link rel="modulepreload" href="./_observablehq/client.fedf0981.js">
<link rel="modulepreload" href="./_observablehq/runtime.e080113b.js">
<link rel="modulepreload" href="./_observablehq/stdlib.eabb1795.js">
<link rel="modulepreload" href="./_npm/htl@0.3.1/72f4716c.js">
<script type="module">

import {define} from "./_observablehq/client.fedf0981.js";

define({id: "9ec8e7a3", outputs: ["brand","serviceLines","pillarLeaders","kanbanStates","swimlanes","columnDescriptions"], body: () => {
// ============================================
// CONFIGURATION & BRAND COLORS
// ============================================

const brand = {
  magenta: "#C4177A",
  magentaLight: "#E91E8C",
  magentaDark: "#9E1362",
  gray: "#54585A",
  grayLight: "#7A7D80",
  grayDark: "#3D4042",
  purple: "#6B3FA0",
  teal: "#008B8B",
  white: "#FFFFFF",
  warmWhite: "#FAFAFA",
  warmGray: "#F5F5F5"
};

const serviceLines = [
  { id: "cardiovascular", name: "Cardiovascular", icon: "â¤ï¸", color: brand.magenta, champion: "Dr. Nezar Falluji" },
  { id: "orthopedic", name: "Orthopedic", icon: "ðŸ¦´", color: brand.teal, champion: "Dr. Ranjan Gupta" },
  { id: "neuroscience", name: "Neuroscience", icon: "ðŸ§ ", color: brand.purple, champion: "Dr. Tom Devlin" },
  { id: "womens-childrens", name: "Women's & Children's", icon: "ðŸ‘¶", color: brand.magentaLight, champion: "Larry Shields, MD" },
];

const pillarLeaders = {
  cardiovascular: { clinical: "Dr. Nezar Falluji", operations: "TBD (Terika Designee)", financial: "TBD (JP Designee)" },
  orthopedic: { clinical: "Dr. Ranjan Gupta", operations: "TBD (Terika Designee)", financial: "TBD (JP Designee)" },
  neuroscience: { clinical: "Dr. Tom Devlin", operations: "TBD (Terika Designee)", financial: "TBD (JP Designee)" },
  "womens-childrens": { clinical: "Larry Shields, MD", operations: "TBD (Terika Designee)", financial: "TBD (JP Designee)" },
};

const kanbanStates = [
  { id: "Funnel", label: "Funnel", color: brand.grayLight },
  { id: "Reviewing", label: "Reviewing", color: brand.purple },
  { id: "Analyzing", label: "Analyzing", color: brand.teal },
  { id: "Backlog", label: "Backlog", color: "#D97706" },
  { id: "Implementing", label: "Implementing", color: brand.magenta },
  { id: "Done", label: "Done", color: brand.gray },
];

const swimlanes = [
  { id: "new-product", label: "ðŸ“¦ New Product Evaluation", color: brand.teal },
  { id: "re-evaluation", label: "ðŸ”„ Product Re-evaluation", color: "#D97706" },
  { id: "sourcing", label: "ðŸŽ¯ Sourcing Strategy", color: brand.magenta },
];

const columnDescriptions = {
  "new-product": {
    "Funnel": "K1: Request received, champion identified",
    "Reviewing": "K2-K3: 8-agent framework initiated, coalition forming",
    "Analyzing": "K3-K4: All 8 agents complete, decision package ready",
    "Backlog": "K4-K5: Kaizen scheduled, awaiting capacity",
    "Implementing": "K5: GO approved, pilot/rollout in progress",
    "Done": "K8: Lookback complete, formulary finalized",
  },
  "re-evaluation": {
    "Funnel": "K1: Trigger identified (safety, evidence, utilization)",
    "Reviewing": "K2-K3: Lookback data collection, stakeholders engaged",
    "Analyzing": "K3-K4: Impact assessment, alternatives evaluated",
    "Backlog": "K4-K5: Kaizen scheduled for reassessment decision",
    "Implementing": "K5: Sustain/Modify/Remove action executing",
    "Done": "K8: Formulary updated, transition complete",
  },
  "sourcing": {
    "Funnel": "S0/K1: Category assessed, urgency documented",
    "Reviewing": "S1/K2: Coalition building, vendor submissions",
    "Analyzing": "S2/K3: Clinical equivalence, business case complete",
    "Backlog": "S3/K4: Strategy Kaizen scheduled, negotiation ready",
    "Implementing": "S4/K5: Contract execution, vendor transition",
    "Done": "S5/K8: Contract live, savings realized",
  },
};
return {brand,serviceLines,pillarLeaders,kanbanStates,swimlanes,columnDescriptions};
}});

define({id: "9f43d801", outputs: ["cardiovascularIssues","orthopedicIssues","neuroscienceIssues","womensChildrensIssues","allData","allIssues"], body: () => {
// ============================================
// SAMPLE DATA (Replace with Linear API later)
// ============================================

const cardiovascularIssues = [
  { id: "COM-380", title: "AGENT Drug-Coated Balloon", brief: "Peripheral artery disease intervention", status: "Implementing", priority: "High", kaizenDate: "2025-10-08", champion: "Dr. Falluji", archetype: "new-product", completion: 90, projectedSavings: null, realizedSavings: null, projectedRevenue: null, realizedRevenue: null, serviceLine: "cardiovascular" },
  { id: "COM-386", title: "T/EVAR Sourcing", brief: "Aortic stent graft consolidation", status: "Implementing", priority: "High", kaizenDate: null, champion: "CVSL Council", archetype: "sourcing", completion: 75, projectedSavings: null, realizedSavings: null, projectedRevenue: null, realizedRevenue: null, serviceLine: "cardiovascular" },
  { id: "COM-387", title: "Renal Denervation", brief: "Resistant hypertension treatment hubs", status: "Analyzing", priority: "Medium", kaizenDate: null, champion: "Dr. Falluji", archetype: "new-product", completion: 65, projectedSavings: null, realizedSavings: null, projectedRevenue: null, realizedRevenue: null, serviceLine: "cardiovascular" },
  { id: "COM-396", title: "EVOQUE", brief: "Tricuspid valve replacement system", status: "Analyzing", priority: "Medium", kaizenDate: null, champion: "Dr. Falluji", archetype: "new-product", completion: 50, projectedSavings: null, realizedSavings: null, projectedRevenue: null, realizedRevenue: null, serviceLine: "cardiovascular" },
  { id: "COM-395", title: "DETOUR", brief: "Femoropopliteal bypass system", status: "Analyzing", priority: "Medium", kaizenDate: null, champion: "Dr. Falluji", archetype: "new-product", completion: 0, projectedSavings: null, realizedSavings: null, projectedRevenue: null, realizedRevenue: null, serviceLine: "cardiovascular" },
  { id: "COM-397", title: "ESPRIT-BTK", brief: "Below-the-knee drug-eluting stent", status: "Analyzing", priority: "Medium", kaizenDate: null, champion: "Dr. Falluji", archetype: "new-product", completion: 0, projectedSavings: null, realizedSavings: null, projectedRevenue: null, realizedRevenue: null, serviceLine: "cardiovascular" },
  { id: "COM-457", title: "GE Cath Lab Modernization", brief: "Imaging equipment standardization", status: "Implementing", priority: "Urgent", kaizenDate: null, champion: "Mary Osborne", archetype: "sourcing", completion: 60, projectedSavings: null, realizedSavings: null, projectedRevenue: null, realizedRevenue: null, serviceLine: "cardiovascular" },
];

const orthopedicIssues = [
  { id: "COM-381", title: "Hip/Knee Sourcing Strategy", brief: "$161M implant consolidation, 106 to 4 vendors", status: "Analyzing", priority: "Urgent", kaizenDate: "2026-01-12", champion: "Dr. Ranjan Gupta", archetype: "sourcing", completion: 60, projectedSavings: "$10-16M", realizedSavings: null, projectedRevenue: null, realizedRevenue: null, serviceLine: "orthopedic" },
  { id: "COM-426", title: "Trauma & Distal Extremity", brief: "$84M nails, plates, external fixation", status: "Funnel", priority: "High", kaizenDate: null, champion: "Dr. Cliff Jones", archetype: "sourcing", completion: 20, projectedSavings: null, realizedSavings: null, projectedRevenue: null, realizedRevenue: null, serviceLine: "orthopedic" },
  { id: "COM-427", title: "Sports Medicine Sourcing", brief: "$42M anchors, shavers, RF pumps", status: "Funnel", priority: "Medium", kaizenDate: null, champion: "TBD", archetype: "sourcing", completion: 40, projectedSavings: null, realizedSavings: null, projectedRevenue: null, realizedRevenue: null, serviceLine: "orthopedic" },
  { id: "COM-428", title: "Spine Sourcing Strategy", brief: "$94M implants, 50 vendors, ortho+neuro", status: "Funnel", priority: "High", kaizenDate: null, champion: "TBD", archetype: "sourcing", completion: 30, projectedSavings: null, realizedSavings: null, projectedRevenue: null, realizedRevenue: null, serviceLine: "orthopedic" },
  { id: "COM-425", title: "Shoulders Sourcing", brief: "$38M total/reverse shoulder implants", status: "Funnel", priority: "Medium", kaizenDate: null, champion: "TBD", archetype: "sourcing", completion: 25, projectedSavings: null, realizedSavings: null, projectedRevenue: null, realizedRevenue: null, serviceLine: "orthopedic" },
];

const neuroscienceIssues = [
  { id: "COM-383", title: "Robotic TCD for PFO Detection", brief: "Automated stroke risk screening, 3x better than echo", status: "Reviewing", priority: "High", kaizenDate: "2026-01-15", champion: "Dr. Tom Devlin", archetype: "new-product", completion: 75, projectedSavings: null, realizedSavings: null, projectedRevenue: null, realizedRevenue: null, serviceLine: "neuroscience" },
  { id: "COM-307", title: "Medivis AI Navigation", brief: "AR surgical navigation for spine procedures", status: "Reviewing", priority: "Medium", kaizenDate: null, champion: "TBD", archetype: "new-product", completion: 20, projectedSavings: null, realizedSavings: null, projectedRevenue: null, realizedRevenue: null, labels: ["blocked"], serviceLine: "neuroscience" },
];

const womensChildrensIssues = [
  { id: "COM-500", title: "Fetal Pillow De-implementation", brief: "First unified three-pillar clinical-supply chain-quality communication", status: "Implementing", priority: "High", kaizenDate: null, champion: "Larry Shields, MD", archetype: "re-evaluation", completion: 80, projectedSavings: null, realizedSavings: null, projectedRevenue: null, realizedRevenue: null, serviceLine: "womens-childrens" },
];

const allData = {
  cardiovascular: cardiovascularIssues,
  orthopedic: orthopedicIssues,
  neuroscience: neuroscienceIssues,
  "womens-childrens": womensChildrensIssues,
};

// Combined data for portfolio view
const allIssues = [...cardiovascularIssues, ...orthopedicIssues, ...neuroscienceIssues, ...womensChildrensIssues];
return {cardiovascularIssues,orthopedicIssues,neuroscienceIssues,womensChildrensIssues,allData,allIssues};
}});

define({id: "1224a20d", inputs: ["brand","serviceLines","Mutable"], outputs: ["viewOptions","selectedViewState","selectedViewId","setView"], body: (brand,serviceLines,Mutable) => {
// ============================================
// VIEW STATE (Using Mutable for tab navigation)
// ============================================

const viewOptions = [
  { id: "portfolio", name: "Portfolio", icon: "ðŸ“Š", color: brand.gray },
  ...serviceLines
];

const selectedViewState = Mutable("portfolio");
const selectedViewId = selectedViewState.generator;

function setView(id) {
  selectedViewState.value = id;
}
return {viewOptions,selectedViewState,selectedViewId,setView};
}});

define({id: "82b9df95", inputs: ["serviceLines"], outputs: ["parseFinancialValue","formatFinancialValue","calculateSavings","calculateRevenue","calculateTotalSavings","calculateTotalRevenue","getUpcomingKaizens","getServiceLineName"], body: (serviceLines) => {
// ============================================
// HELPER FUNCTIONS
// ============================================

function parseFinancialValue(value) {
  if (!value) return { low: 0, high: 0 };
  const match = value.match(/\$?([\d.]+)(?:-([\d.]+))?\s*M?/i);
  if (match) {
    const low = parseFloat(match[1]);
    const high = match[2] ? parseFloat(match[2]) : low;
    return { low, high };
  }
  return { low: 0, high: 0 };
}

function formatFinancialValue(low, high) {
  if (low === 0 && high === 0) return "â€”";
  return low === high ? `$${low}M` : `$${low}-${high}M`;
}

function calculateSavings(issues, type = "projected") {
  let low = 0, high = 0;
  const field = type === "realized" ? "realizedSavings" : "projectedSavings";
  issues.forEach(i => {
    const parsed = parseFinancialValue(i[field]);
    low += parsed.low;
    high += parsed.high;
  });
  return formatFinancialValue(low, high);
}

function calculateRevenue(issues, type = "projected") {
  let low = 0, high = 0;
  const field = type === "realized" ? "realizedRevenue" : "projectedRevenue";
  issues.forEach(i => {
    const parsed = parseFinancialValue(i[field]);
    low += parsed.low;
    high += parsed.high;
  });
  return formatFinancialValue(low, high);
}

function calculateTotalSavings(issues) {
  return {
    projected: calculateSavings(issues, "projected"),
    realized: calculateSavings(issues, "realized")
  };
}

function calculateTotalRevenue(issues) {
  return {
    projected: calculateRevenue(issues, "projected"),
    realized: calculateRevenue(issues, "realized")
  };
}

function getUpcomingKaizens(issues) {
  return issues
    .filter(i => i.kaizenDate)
    .sort((a, b) => new Date(a.kaizenDate) - new Date(b.kaizenDate))
    .slice(0, 5);
}

function getServiceLineName(id) {
  const sl = serviceLines.find(s => s.id === id);
  return sl ? sl.name : id;
}
return {parseFinancialValue,formatFinancialValue,calculateSavings,calculateRevenue,calculateTotalSavings,calculateTotalRevenue,getUpcomingKaizens,getServiceLineName};
}});

define({id: "41c4d0c9", inputs: ["isPortfolioView","html","allIssues","serviceLines","calculateSavings","calculateRevenue","selectedView","currentIssues","currentLeaders","display"], body: async (isPortfolioView,html,allIssues,serviceLines,calculateSavings,calculateRevenue,selectedView,currentIssues,currentLeaders,display) => {
display(await(
// ============================================
// PORTFOLIO HERO SECTION
// ============================================

isPortfolioView ? html`<div class="hero-section">
  <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 16px;">
    <div style="font-size: 48px;">ðŸ“Š</div>
    <div>
      <h1>COF Portfolio Overview</h1>
      <p style="opacity: 0.9; margin: 0;">Clinical-Operational-Financial Three-Pillar Governance</p>
    </div>
  </div>

  <div class="stat-grid" style="grid-template-columns: repeat(6, 1fr);">
    <div class="stat-card">
      <div style="font-size: 12px; text-transform: uppercase; letter-spacing: 0.1em; opacity: 0.8;">Total Items</div>
      <div style="font-size: 36px; font-weight: 800;">${allIssues.length}</div>
    </div>
    <div class="stat-card">
      <div style="font-size: 12px; text-transform: uppercase; letter-spacing: 0.1em; opacity: 0.8;">Service Lines</div>
      <div style="font-size: 36px; font-weight: 800;">${serviceLines.length}</div>
    </div>
    <div class="stat-card">
      <div style="font-size: 12px; text-transform: uppercase; letter-spacing: 0.1em; opacity: 0.8;">Projected Savings</div>
      <div style="font-size: 24px; font-weight: 800;">${calculateSavings(allIssues, "projected")}</div>
    </div>
    <div class="stat-card">
      <div style="font-size: 12px; text-transform: uppercase; letter-spacing: 0.1em; opacity: 0.8;">Realized Savings</div>
      <div style="font-size: 24px; font-weight: 800;">${calculateSavings(allIssues, "realized")}</div>
    </div>
    <div class="stat-card">
      <div style="font-size: 12px; text-transform: uppercase; letter-spacing: 0.1em; opacity: 0.8;">Projected Revenue</div>
      <div style="font-size: 24px; font-weight: 800;">${calculateRevenue(allIssues, "projected")}</div>
    </div>
    <div class="stat-card">
      <div style="font-size: 12px; text-transform: uppercase; letter-spacing: 0.1em; opacity: 0.8;">Realized Revenue</div>
      <div style="font-size: 24px; font-weight: 800;">${calculateRevenue(allIssues, "realized")}</div>
    </div>
  </div>
</div>` : html`<div class="hero-section compact">
  <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 16px;">
    <div style="font-size: 48px;">${selectedView.icon}</div>
    <div>
      <h1>${selectedView.name} Service Line</h1>
      <p style="opacity: 0.9; margin: 0;">Clinical-Operational-Financial Three-Pillar Governance</p>
    </div>
  </div>

  <div class="stat-grid" style="grid-template-columns: repeat(5, 1fr);">
    <div class="stat-card">
      <div style="font-size: 12px; text-transform: uppercase; letter-spacing: 0.1em; opacity: 0.8;">Active Items</div>
      <div style="font-size: 36px; font-weight: 800;">${currentIssues.length}</div>
    </div>
    <div class="stat-card">
      <div style="font-size: 12px; text-transform: uppercase; letter-spacing: 0.1em; opacity: 0.8;">Projected Savings</div>
      <div style="font-size: 24px; font-weight: 800;">${calculateSavings(currentIssues, "projected")}</div>
      <div style="font-size: 11px; opacity: 0.7; margin-top: 4px;">Realized: ${calculateSavings(currentIssues, "realized")}</div>
    </div>
    <div class="stat-card">
      <div style="font-size: 12px; text-transform: uppercase; letter-spacing: 0.1em; opacity: 0.8;">Projected Revenue</div>
      <div style="font-size: 24px; font-weight: 800;">${calculateRevenue(currentIssues, "projected")}</div>
      <div style="font-size: 11px; opacity: 0.7; margin-top: 4px;">Realized: ${calculateRevenue(currentIssues, "realized")}</div>
    </div>
    <div class="stat-card">
      <div style="font-size: 12px; text-transform: uppercase; letter-spacing: 0.1em; opacity: 0.8;">Clinical Champion</div>
      <div style="font-size: 16px; font-weight: 700;">${currentLeaders?.clinical || "â€”"}</div>
    </div>
  </div>
</div>`
))
}});

define({id: "2984ce64", inputs: ["isPortfolioView","html","serviceLines","allData","setView","brand","calculateSavings","display"], body: async (isPortfolioView,html,serviceLines,allData,setView,brand,calculateSavings,display) => {
display(await(
// ============================================
// SERVICE LINE CARDS (Portfolio View Only)
// ============================================

isPortfolioView ? html`
<h2 style="margin-bottom: 16px;">Service Lines</h2>
<div class="grid-4" style="margin-bottom: 32px;">
  ${serviceLines.map(sl => {
    const issues = allData[sl.id] || [];
    const implementing = issues.filter(i => i.status === "Implementing").length;
    const blocked = issues.filter(i => i.labels?.some(l => l.toLowerCase().includes("blocked"))).length;
    return html`
      <div class="card" style="border-top: 4px solid ${sl.color}; cursor: pointer; transition: all 0.2s ease;"
        onclick=${() => setView(sl.id)}
        onmouseover=${(e) => { e.currentTarget.style.transform = 'translateY(-4px)'; e.currentTarget.style.boxShadow = '0 8px 24px rgba(0,0,0,0.12)'; }}
        onmouseout=${(e) => { e.currentTarget.style.transform = 'translateY(0)'; e.currentTarget.style.boxShadow = ''; }}>
        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
          <div style="font-size: 32px;">${sl.icon}</div>
          <div>
            <h4 style="margin: 0; color: ${brand.gray};">${sl.name}</h4>
            <div style="font-size: 12px; color: ${brand.grayLight};">${sl.champion}</div>
          </div>
        </div>
        <div style="display: flex; justify-content: space-between; font-size: 14px;">
          <span style="color: ${brand.grayLight};">Items</span>
          <span style="font-weight: 700; color: ${brand.gray};">${issues.length}</span>
        </div>
        <div style="display: flex; justify-content: space-between; font-size: 14px; margin-top: 4px;">
          <span style="color: ${brand.grayLight};">In Progress</span>
          <span style="font-weight: 700; color: ${brand.magenta};">${implementing}</span>
        </div>
        ${blocked > 0 ? html`
        <div style="display: flex; justify-content: space-between; font-size: 14px; margin-top: 4px;">
          <span style="color: ${brand.grayLight};">Blocked</span>
          <span style="font-weight: 700; color: #ef4444;">${blocked}</span>
        </div>` : ""}
        <div style="display: flex; justify-content: space-between; font-size: 14px; margin-top: 4px;">
          <span style="color: ${brand.grayLight};">Proj. Savings</span>
          <span style="font-weight: 700; color: ${brand.teal};">${calculateSavings(issues, "projected")}</span>
        </div>
        <div style="display: flex; justify-content: space-between; font-size: 14px; margin-top: 4px;">
          <span style="color: ${brand.grayLight};">Realized</span>
          <span style="font-weight: 700; color: #10B981;">${calculateSavings(issues, "realized")}</span>
        </div>
        <div style="margin-top: 12px; text-align: center; font-size: 12px; color: ${sl.color}; font-weight: 600;">
          View Details â†’
        </div>
      </div>
    `;
  })}
</div>` : ""
))
}});

define({id: "14046e4c", inputs: ["isPortfolioView","currentLeaders","html","brand","display"], body: async (isPortfolioView,currentLeaders,html,brand,display) => {
display(await(
// ============================================
// THREE-PILLAR REPRESENTATIVES (Service Line View Only)
// ============================================

!isPortfolioView && currentLeaders ? html`
<h2 style="margin-bottom: 16px;">Three-Pillar Representatives</h2>
<div class="grid-3" style="margin-bottom: 32px;">
  <div class="card" style="border-left: 4px solid ${brand.magenta};">
    <h4 style="color: ${brand.magenta}; margin-bottom: 8px;">Clinical Pillar</h4>
    <div style="font-size: 16px; font-weight: 600;">${currentLeaders.clinical}</div>
  </div>
  <div class="card" style="border-left: 4px solid ${brand.purple};">
    <h4 style="color: ${brand.purple}; margin-bottom: 8px;">Operations Pillar</h4>
    <div style="font-size: 16px; font-weight: 600;">${currentLeaders.operations}</div>
  </div>
  <div class="card" style="border-left: 4px solid ${brand.teal};">
    <h4 style="color: ${brand.teal}; margin-bottom: 8px;">Financial Pillar</h4>
    <div style="font-size: 16px; font-weight: 600;">${currentLeaders.financial}</div>
  </div>
</div>` : ""
))
}});

define({id: "37c2261c", inputs: ["getUpcomingKaizens","allIssues","isPortfolioView","html","serviceLines","brand"], outputs: ["upcomingKaizens"], body: (getUpcomingKaizens,allIssues,isPortfolioView,html,serviceLines,brand) => {
// ============================================
// UPCOMING KAIZENS (Portfolio View Only)
// ============================================

const upcomingKaizens = getUpcomingKaizens(allIssues);

isPortfolioView && upcomingKaizens.length > 0 ? html`
<h2 style="margin-bottom: 16px;">Upcoming Kaizens</h2>
<div class="card" style="margin-bottom: 32px;">
  <div style="display: flex; flex-direction: column; gap: 12px;">
    ${upcomingKaizens.map(item => {
      const sl = serviceLines.find(s => s.id === item.serviceLine);
      return html`
        <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: #f8fafc; border-radius: 8px; border-left: 4px solid ${sl?.color || brand.gray};">
          <div>
            <div style="font-weight: 600; color: ${brand.gray};">${item.title}</div>
            <div style="font-size: 12px; color: ${brand.grayLight};">${sl?.name || item.serviceLine} - ${item.champion}</div>
          </div>
          <div style="text-align: right;">
            <div style="font-weight: 700; color: ${brand.purple};">${item.kaizenDate}</div>
            <div style="font-size: 12px; color: ${brand.grayLight};">${item.archetype}</div>
          </div>
        </div>
      `;
    })}
  </div>
</div>` : ""
return {upcomingKaizens};
}});

define({id: "a6fa1916", inputs: ["isPortfolioView","html","kanbanStates","allIssues","brand","display"], body: async (isPortfolioView,html,kanbanStates,allIssues,brand,display) => {
display(await(
// ============================================
// PIPELINE BY STATUS (Portfolio View Only)
// ============================================

isPortfolioView ? html`
<h2 style="margin-bottom: 16px;">Pipeline by Status</h2>
<div class="card" style="margin-bottom: 32px;">
  <div style="display: grid; grid-template-columns: repeat(6, 1fr); gap: 12px;">
    ${kanbanStates.map(state => {
      const count = allIssues.filter(i => i.status === state.id).length;
      const percentage = Math.round((count / allIssues.length) * 100) || 0;
      return html`
        <div style="text-align: center;">
          <div style="font-size: 32px; font-weight: 800; color: ${state.color};">${count}</div>
          <div style="font-size: 11px; font-weight: 600; color: white; background: ${state.color}; padding: 4px 8px; border-radius: 4px; margin-top: 4px;">${state.label}</div>
          <div style="font-size: 11px; color: ${brand.grayLight}; margin-top: 4px;">${percentage}%</div>
        </div>
      `;
    })}
  </div>
</div>` : ""
))
}});

define({id: "9eb208ef", inputs: ["kanbanStates","html","brand","swimlanes","columnDescriptions","serviceLines"], outputs: ["renderKanban"], body: (kanbanStates,html,brand,swimlanes,columnDescriptions,serviceLines) => {
// Render Kanban board
function renderKanban(issues, showServiceLine = false) {
  const columns = kanbanStates;

  return html`
    <div class="card" style="padding: 24px; overflow-x: auto;">
      <!-- Column Headers -->
      <div style="display: grid; grid-template-columns: 180px repeat(${columns.length}, 1fr); gap: 8px; margin-bottom: 12px; min-width: 1000px;">
        <div style="font-size: 11px; color: ${brand.grayLight}; padding: 4px 8px;">Archetype</div>
        ${columns.map(col => html`
          <div style="font-size: 11px; font-weight: 600; color: white; background: ${col.color}; padding: 8px; border-radius: 6px; text-align: center; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
            ${col.label}
          </div>
        `)}
      </div>

      <!-- Swimlanes -->
      ${swimlanes.map(swimlane => {
        const swimlaneIssues = issues.filter(i => i.archetype === swimlane.id);
        const descriptions = columnDescriptions[swimlane.id];

        return html`
          <div style="margin-bottom: 20px; min-width: 1000px;">
            <!-- Swimlane Header -->
            <div style="display: grid; grid-template-columns: 180px repeat(${columns.length}, 1fr); gap: 8px; margin-bottom: 4px;">
              <div style="font-size: 12px; font-weight: 600; color: ${swimlane.color}; background: ${swimlane.color}15; padding: 10px; border-radius: 8px; overflow: hidden;">
                ${swimlane.label}
              </div>
              ${columns.map(col => html`
                <div style="font-size: 10px; color: ${brand.grayLight}; padding: 4px; line-height: 1.3; overflow: hidden;">
                  ${descriptions[col.id]}
                </div>
              `)}
            </div>

            <!-- Issue Cards -->
            <div style="display: grid; grid-template-columns: 180px repeat(${columns.length}, 1fr); gap: 8px;">
              <div></div>
              ${columns.map(col => {
                const cellIssues = swimlaneIssues.filter(i => i.status === col.id);
                return html`
                  <div style="min-height: 60px; background: #f8fafc; border-radius: 6px; padding: 6px;">
                    ${cellIssues.map(issue => {
                      const isBlocked = issue.labels?.some(l => l.toLowerCase().includes("blocked"));
                      const sl = serviceLines.find(s => s.id === issue.serviceLine);
                      return html`
                        <a href="https://linear.app/commonspirit/issue/${issue.id}" target="_blank" style="display: block; background: white; border-radius: 6px; padding: 10px; margin-bottom: 6px; border: 1px solid ${isBlocked ? '#fca5a5' : '#e2e8f0'}; border-left: 4px solid ${showServiceLine ? (sl?.color || '#e2e8f0') : (isBlocked ? '#ef4444' : '#e2e8f0')}; text-decoration: none; transition: all 0.2s;">
                          <div style="display: flex; justify-content: space-between; align-items: start;">
                            <div style="font-size: 12px; font-weight: 600; color: ${brand.gray};">${issue.title}</div>
                            ${isBlocked ? html`<div style="width: 8px; height: 8px; border-radius: 50%; background: #ef4444; flex-shrink: 0;"></div>` : ""}
                          </div>
                          ${showServiceLine ? html`<div style="font-size: 10px; color: ${sl?.color || brand.grayLight}; margin-top: 2px;">${sl?.icon} ${sl?.name}</div>` : ""}
                          <div style="font-size: 10px; color: ${brand.grayLight}; margin-top: 4px;">${issue.brief}</div>
                          ${issue.projectedSavings || issue.realizedSavings || issue.projectedRevenue || issue.realizedRevenue ? html`
                            <div style="font-size: 10px; margin-top: 6px; font-weight: 600;">
                              ${issue.projectedSavings ? html`<span style="color: ${brand.teal};" title="Projected Savings">ðŸ“Š ${issue.projectedSavings}</span>` : ""}
                              ${issue.realizedSavings ? html`<span style="color: #10B981; margin-left: 4px;" title="Realized Savings">âœ“ ${issue.realizedSavings}</span>` : ""}
                              ${issue.projectedRevenue ? html`<span style="color: ${brand.magenta}; margin-left: 6px;" title="Projected Revenue">ðŸ“Š +${issue.projectedRevenue}</span>` : ""}
                              ${issue.realizedRevenue ? html`<span style="color: #10B981; margin-left: 4px;" title="Realized Revenue">âœ“ +${issue.realizedRevenue}</span>` : ""}
                            </div>
                          ` : ""}
                          <div style="font-size: 10px; color: ${brand.purple}; margin-top: 6px;">
                            ${issue.kaizenDate || "TBD"}
                          </div>
                        </a>
                      `;
                    })}
                  </div>
                `;
              })}
            </div>
          </div>
        `;
      })}
    </div>
  `;
}
return {renderKanban};
}});

define({id: "bf58b735", inputs: ["renderKanban","currentIssues","isPortfolioView","display"], body: async (renderKanban,currentIssues,isPortfolioView,display) => {
display(await(
renderKanban(currentIssues, isPortfolioView)
))
}});

define({id: "30c795b0", inputs: ["currentIssues"], outputs: ["projectedSavingsItems","realizedSavingsItems","projectedRevenueItems","realizedRevenueItems","quantifiedCount","realizedCount"], body: (currentIssues) => {
const projectedSavingsItems = currentIssues.filter(i => i.projectedSavings);
const realizedSavingsItems = currentIssues.filter(i => i.realizedSavings);
const projectedRevenueItems = currentIssues.filter(i => i.projectedRevenue);
const realizedRevenueItems = currentIssues.filter(i => i.realizedRevenue);
const quantifiedCount = new Set([...projectedSavingsItems, ...projectedRevenueItems].map(i => i.id)).size;
const realizedCount = new Set([...realizedSavingsItems, ...realizedRevenueItems].map(i => i.id)).size;
return {projectedSavingsItems,realizedSavingsItems,projectedRevenueItems,realizedRevenueItems,quantifiedCount,realizedCount};
}});

define({id: "6aecc148", inputs: ["html","brand","quantifiedCount","calculateSavings","currentIssues","calculateRevenue","realizedCount","projectedSavingsItems","realizedSavingsItems","serviceLines","isPortfolioView","projectedRevenueItems","realizedRevenueItems","display"], body: async (html,brand,quantifiedCount,calculateSavings,currentIssues,calculateRevenue,realizedCount,projectedSavingsItems,realizedSavingsItems,serviceLines,isPortfolioView,projectedRevenueItems,realizedRevenueItems,display) => {
display(await(
html`<div class="card">
  <h4 style="margin-bottom: 16px;">Financial Impact Summary</h4>

  <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 20px;">
    <div style="padding: 12px; background: #f0f9ff; border-radius: 8px; border-left: 4px solid ${brand.teal};">
      <div style="font-size: 11px; text-transform: uppercase; color: ${brand.grayLight}; margin-bottom: 4px;">Projected</div>
      <div style="font-size: 14px; font-weight: 600; color: ${brand.gray};">${quantifiedCount} items quantified</div>
      <div style="font-size: 18px; font-weight: 700; color: ${brand.teal}; margin-top: 4px;">${calculateSavings(currentIssues, "projected")} savings</div>
      <div style="font-size: 14px; color: ${brand.magenta};">${calculateRevenue(currentIssues, "projected")} revenue</div>
    </div>
    <div style="padding: 12px; background: #f0fdf4; border-radius: 8px; border-left: 4px solid #10B981;">
      <div style="font-size: 11px; text-transform: uppercase; color: ${brand.grayLight}; margin-bottom: 4px;">Realized</div>
      <div style="font-size: 14px; font-weight: 600; color: ${brand.gray};">${realizedCount} items realized</div>
      <div style="font-size: 18px; font-weight: 700; color: #10B981; margin-top: 4px;">${calculateSavings(currentIssues, "realized")} savings</div>
      <div style="font-size: 14px; color: #10B981;">${calculateRevenue(currentIssues, "realized")} revenue</div>
    </div>
  </div>

  ${projectedSavingsItems.length > 0 || realizedSavingsItems.length > 0 ? html`
    <h5 style="font-size: 12px; text-transform: uppercase; color: ${brand.grayLight}; margin-bottom: 8px;">Savings Detail</h5>
    <div style="display: flex; flex-direction: column; gap: 8px; margin-bottom: 16px;">
      ${projectedSavingsItems.map(item => {
        const sl = serviceLines.find(s => s.id === item.serviceLine);
        return html`
        <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px; background: #f0f9ff; border-radius: 6px;">
          <div>
            <span style="color: ${brand.gray};">${item.title}</span>
            ${isPortfolioView ? html`<span style="font-size: 11px; color: ${sl?.color || brand.grayLight}; margin-left: 8px;">${sl?.icon} ${sl?.name}</span>` : ""}
          </div>
          <div style="text-align: right;">
            <div style="font-weight: 600; color: ${brand.teal};">ðŸ“Š ${item.projectedSavings}</div>
            ${item.realizedSavings ? html`<div style="font-size: 12px; color: #10B981;">âœ“ ${item.realizedSavings}</div>` : ""}
          </div>
        </div>
      `})}
    </div>
  ` : ""}

  ${projectedRevenueItems.length > 0 || realizedRevenueItems.length > 0 ? html`
    <h5 style="font-size: 12px; text-transform: uppercase; color: ${brand.grayLight}; margin-bottom: 8px;">Revenue Detail</h5>
    <div style="display: flex; flex-direction: column; gap: 8px;">
      ${projectedRevenueItems.map(item => {
        const sl = serviceLines.find(s => s.id === item.serviceLine);
        return html`
        <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px; background: #fdf4f8; border-radius: 6px;">
          <div>
            <span style="color: ${brand.gray};">${item.title}</span>
            ${isPortfolioView ? html`<span style="font-size: 11px; color: ${sl?.color || brand.grayLight}; margin-left: 8px;">${sl?.icon} ${sl?.name}</span>` : ""}
          </div>
          <div style="text-align: right;">
            <div style="font-weight: 600; color: ${brand.magenta};">ðŸ“Š +${item.projectedRevenue}</div>
            ${item.realizedRevenue ? html`<div style="font-size: 12px; color: #10B981;">âœ“ +${item.realizedRevenue}</div>` : ""}
          </div>
        </div>
      `})}
    </div>
  ` : ""}

  ${projectedSavingsItems.length === 0 && projectedRevenueItems.length === 0 ? html`<p style="color: ${brand.grayLight};">No items quantified yet</p>` : ""}
</div>`
))
}});

define({id: "bbc33935", inputs: ["html","brand","display"], body: async (html,brand,display) => {
display(await(
html`<div style="text-align: center; color: ${brand.grayLight}; font-size: 12px; margin-top: 32px;">
  <a href="https://linear.app/commonspirit" target="_blank" style="color: ${brand.purple};">Open Linear â†’</a>
</div>`
))
}});

</script>
</head>
<body>
<div id="observablehq-center">
<aside id="observablehq-toc" data-selector="h1:not(:first-of-type)[id], h2:first-child[id], :not(h1) + h2[id]">
<nav>
<div>Contents</div>
<ol>
<li class="observablehq-secondary-link"><a href="#product-and-sourcing-kanban">Product &amp; Sourcing Kanban</a></li>
<li class="observablehq-secondary-link"><a href="#financial-impact">Financial Impact</a></li>
</ol>
</nav>
</aside>
<main id="observablehq-main" class="observablehq">
<div class="observablehq observablehq--block"><!--:9ec8e7a3:--></div>
<div class="observablehq observablehq--block"><!--:9f43d801:--></div>
<div class="observablehq observablehq--block"><!--:1224a20d:--></div>
<div class="observablehq observablehq--block">
  <div class="observablehq--inspect observablehq--error">SyntaxError: Unterminated template (49:3)</div>
</div>
<div class="observablehq observablehq--block"><!--:82b9df95:--></div>
<div class="observablehq observablehq--block"><observablehq-loading></observablehq-loading><!--:41c4d0c9:--></div>
<div class="observablehq observablehq--block"><observablehq-loading></observablehq-loading><!--:2984ce64:--></div>
<div class="observablehq observablehq--block"><observablehq-loading></observablehq-loading><!--:14046e4c:--></div>
<div class="observablehq observablehq--block"><!--:37c2261c:--></div>
<div class="observablehq observablehq--block"><observablehq-loading></observablehq-loading><!--:a6fa1916:--></div>
<h2 id="product-and-sourcing-kanban" tabindex="-1"><a class="observablehq-header-anchor" href="#product-and-sourcing-kanban">Product &amp; Sourcing Kanban</a></h2>
<div class="observablehq observablehq--block"><!--:9eb208ef:--></div>
<div class="observablehq observablehq--block"><observablehq-loading></observablehq-loading><!--:bf58b735:--></div>
<h2 id="financial-impact" tabindex="-1"><a class="observablehq-header-anchor" href="#financial-impact">Financial Impact</a></h2>
<div class="observablehq observablehq--block"><!--:30c795b0:--></div>
<div class="observablehq observablehq--block"><observablehq-loading></observablehq-loading><!--:6aecc148:--></div>
<hr>
<div class="observablehq observablehq--block"><observablehq-loading></observablehq-loading><!--:bbc33935:--></div>
</main>
</div>
</body>
</html>
